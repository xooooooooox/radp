# 告诉Nginx去哪个"来源字段"里找真实客户端IP
# If you use X-Forwarded-For
real_ip_header X-Forwarded-For;
# If you terminate with PROXY protocol instead, switch to:
# real_ip_header proxy_protocol;

# 声明可信代理的网段(也就是允许哪些来源来"声明/替换"客户端IP).
# 只有来自这些网段的连接,Nginx才会信任其X-Forwarded-For或Proxy协议信息
# 请根据实际的LB/Ingress边界网段填写,以下为常见内网
# TRUSTED proxy/LB networks (examples; replace with yours)
set_real_ip_from 10.0.0.0/8;
set_real_ip_from 172.16.0.0/12;
set_real_ip_from 192.168.0.0/16;

# set_real_ip_from 203.0.113.0/24;  # e.g. public LB range

# 递归想做解析 X-Forwarded-For 链,知道遇到第一个不在可信网段的IP(也就是最靠近客户端的那个), 不开启时只看第一跳
real_ip_recursive on;
